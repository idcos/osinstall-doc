# 一键部署

考虑到用户搭建平台环境的复杂性，这里我们提供了一键部署服务，集成了所有的组件，推荐用户使用此方式来快速部署一套环境，一分钟就可以完成整个环境的搭建。

## 系统依赖

* RedHat/CentOS 6.0以上版本，对系统安装的包没有要求，最小化安装即可
* 关闭防火墙

```bash
# service iptables stop
# chkconfig iptables off
```

* 关闭selinux（需重启生效）

```bash
# sed -i.bak '/^SELINUX=/cSELINUX=disabled' /etc/sysconfig/selinux
```

## 安装方法

* 下载一键安装包

  [http://www.idcos.com/opensource/cloudboot-open-source](http://www.idcos.com/opensource/cloudboot-open-source)

* 执行安装命令

```bash
# rpm -ivh cloudboot-$version.x86_64.rpm
Preparing...                ########################################### [100%]
   1:cloudboot              ########################################### [100%]
```

**如果系统上有多个 IP，安装的时候请指定用哪个 IP 地址来提供装机服务，例如：**

```bash
IP=192.168.2.1 rpm -ivh cloudboot-$version.x86_64.rpm
```

* 导入ISO系统安装介质到对应目录（以centos 7.6为例）

```bash
# mount -o loop CentOS-7-x86_64-DVD-1810.iso /media
# mkdir -p /opt/cloudboot/home/www/centos/7.6/os/x86_64/
# rsync -a /media/ /opt/cloudboot/home/www/centos/7.6/os/x86_64/
# umount /media
```

* 启动CloudBoot系统

```bash
# service cloudboot start
Starting dhcpd:                                            [  OK  ]
Starting dnsmasq:                                          [  OK  ]
Starting xinetd:                                           [  OK  ]
Starting nginx:                                            [  OK  ]
Starting SMB services:                                     [  OK  ]
Starting mysqld:                                           [  OK  ]
Starting cloudboot-server:                                 [  OK  ]
Starting act2-master:                                      [  OK  ]
Starting act2-proxy:                                       [  OK  ]
```

* 通过浏览器访问本机 IP 即可（推荐使用最新的 Chrome 浏览器，**用户名/密码都是 admin**）

## 说明

cloudboot一键安装包集成了```dhcp/tftp/http/dns/samba/mysql/cloudboot-server/act2-master/act2-proxy```服务于一身，不依赖系统组件，所有的服务都安装在```/opt/cloudboot```目录下面。除了基础服务以外，cloudboot安装包还集成了```bootos```，```winpe```，```hw-tools```，```winconfig```，```windows安装驱动```（这里提供的驱动仅供参考，实际以官方为准）等所有安装涉及到的组件，用户只需要安装此包即可，不需要在下载其他组件。真正做到了一键部署，一分钟搭建环境。

* 一键部署涉及到的配置文件如下，如有需求可以自行修改

```bash
/opt/cloudboot/etc/cloudboot-server/cloudboot-server.conf
/opt/cloudboot/etc/dhcp/dhcpd.conf
/opt/cloudboot/etc/dnsmasq.conf
/opt/cloudboot/etc/dnsmasq.d/hosts.conf
/opt/cloudboot/etc/nginx/conf.d/default.conf
/opt/cloudboot/etc/nginx/nginx.conf
/opt/cloudboot/etc/resolv.conf
/opt/cloudboot/etc/samba/smb.conf
/opt/cloudboot/etc/xinetd.d/tftp
/opt/cloudboot/var/lib/tftpboot/pxelinux.cfg/default
/opt/cloudboot/usr/yunji/cloud-act2/etc/cloud-act2-proxy.yaml
/opt/cloudboot/usr/yunji/cloud-act2/etc/cloud-act2.yaml
```

* 一键部署服务管理，使用service命令可以批量启停单个或者全部服务

```bash
# service cloudboot
Usage: service cloudboot [dhcpd|dnsmasq|xinetd|nginx|smb|mysqld|cloudboot-server|act2-master|act2-proxy] {start|stop|restart|reload|condrestart|status}
```

例如，关闭dhcp服务

```bash
# service cloudboot dhcpd stop
Shutting down dhcpd:                                       [  OK  ]
```

例如，重启所有服务

```bash
# service cloudboot restart
Shutting down dhcpd:                                       [  OK  ]
Starting dhcpd:                                            [  OK  ]
Shutting down dnsmasq:                                     [  OK  ]
Starting dnsmasq:                                          [  OK  ]
Stopping xinetd:                                           [  OK  ]
Starting xinetd:                                           [  OK  ]
Stopping nginx:                                            [  OK  ]
Starting nginx:                                            [  OK  ]
Shutting down SMB services:                                [  OK  ]
Starting SMB services:                                     [  OK  ]
Stopping mysqld:                                           [  OK  ]
Starting mysqld:                                           [  OK  ]
Starting cloudboot-server:                                 [  OK  ]
```
